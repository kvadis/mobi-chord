<?xml version="1.0" encoding="UTF-8"?>
<record_update table="sys_ui_script">
    <sys_ui_script action="INSERT_OR_UPDATE">
        <active>true</active>
        <description/>
        <global>false</global>
        <name>x_20458_mobi_chord.tableController</name>
        <script><![CDATA[var app = angular.module('angularapp', ['ngTable', 'chart.js']);

app.controller('MainCtrl', MainCtrl);
app.controller('RadarCtrl', RadarCtrl);

MainCtrl.$inject = ['$scope', '$filter', '$http', 'NgTableParams'];

function MainCtrl($scope, $filter, $http, NgTableParams) {
  var self = this;

  self.tableParams = new NgTableParams({
  }, {
    filterDelay: 0,
	  
    getData: function (params) {
      var url = '/api/now/table/incident';
      var queryOptions = {
        sysparm_display_value: 'true',
        sysparm_exclude_reference_link: 'true',
        sysparm_fields: 'number,urgency,caller_id,opened_at,state',
        sysparm_query: '',
		sysparm_limit: params.count(),
		sysparm_offset: (params.page()-1) * params.count()
      };
      if (params.hasFilter()){
        console.log('filter() = ' + JSON.stringify(params.filter()));
        queryOptions.filter = params.filter();
      }
      if (Object.keys(params.sorting()).length != 0){
		  for (var field in params.sorting()){
			  var direction = (params.sorting()[field] == 'desc') ? 'ORDERBYDESC' : 'ORDERBY';
			  queryOptions.sysparm_query += direction + field;
			  /*queryOptions.sysparm_order = key;
			  queryOptions.sysparm_order_direction = params.sorting()[key];*/
		  }
      }
      return $http.get(url, {
        params: queryOptions,
        headers: {'Content-Type':'application/json', 'Accept':'application/json', 'X-UserToken':window.g_ck}
      })
        .then(function (res) {
            var vals = [];
            var resArray = res.data.result;
            for (var i = 0; i < resArray.length; i++) {
              vals.push({
                "number": resArray[i].number,
                "urgency": resArray[i].urgency,
                "caller_id": resArray[i].caller_id,
                "opened_at": new Date(resArray[i].opened_at),
                "state": resArray[i].state
              });
            }
			params.total(res.headers('X-Total-Count'));
            return vals;
          }, function (reason) {
            //$defer.reject();
          }
        );
    }
  });
}


RadarCtrl.$inject = ['$scope'];

function RadarCtrl($scope) {
 $scope.labels = ["Download Sales", "In-Store Sales", "Mail-Order Sales"];
  $scope.data = [300, 500, 100];
}]]></script>
        <script_name>tableController</script_name>
        <sys_class_name>sys_ui_script</sys_class_name>
        <sys_created_by>kostya.kozachuk</sys_created_by>
        <sys_created_on>2018-04-13 09:18:41</sys_created_on>
        <sys_id>3ac6d373db111300d1dcfcdfbf9619be</sys_id>
        <sys_mod_count>98</sys_mod_count>
        <sys_name>x_20458_mobi_chord.tableController</sys_name>
        <sys_package display_value="Mobi Chord POC" source="x_20458_mobi_chord">d430280bdb111300d1dcfcdfbf96198a</sys_package>
        <sys_policy/>
        <sys_scope display_value="Mobi Chord POC">d430280bdb111300d1dcfcdfbf96198a</sys_scope>
        <sys_update_name>sys_ui_script_3ac6d373db111300d1dcfcdfbf9619be</sys_update_name>
        <sys_updated_by>kostya.kozachuk</sys_updated_by>
        <sys_updated_on>2018-04-17 13:40:01</sys_updated_on>
        <use_scoped_format>false</use_scoped_format>
    </sys_ui_script>
</record_update>
